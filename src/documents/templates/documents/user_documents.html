{% extends "base.html" %}
{% load static %}


{% block CSS %}
<link href="{% static 'css/style_display_users.css' %}" rel="stylesheet">
{% endblock CSS %}



{% block content %}


<!-- TABLA DE CONTENIDO  -->
<section>
	<div class="container">
		<div class="col-lg-12 text-center">
			<div class="section-title">
				<h2>EDITAR AIP</h2>
				<a data-toggle="modal" data-toggle="tooltip" data-placement="bottom" title="Subir un documento."  data-target="#agregar_documento_id">
					<button class="btn btn-primary"> <i class="glyphicon glyphicon-file"></i> <i class="glyphicon glyphicon-plus"></i> </button>
				</a>

			</div>
		</div>
		
        <div class="row">

			<div class="col-md-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title"><strong>Capitulos</strong></h3>
						<div class="pull-right">
							<span class="clickable filter" data-toggle="tooltip" title="Toggle table filter" data-container="body">
								<i class="glyphicon glyphicon-search"></i>
							</span>
						</div>
					</div>
					<div class="panel-body">
						<input type="text" class="form-control" id="categorias-filter" data-action="filter" data-filters="#categorias" placeholder="Filter Developers" />
					</div>
					<table class="table table-hover" id="categorias">
						<thead>
							<tr>
								<th>&nbsp;</th>
								<th>Secciones</th>
								<th>Descripcion</th>
								<th>Acción</th>
							</tr>
						</thead>
						<tbody>
							{% for obj in object_list %}
								<tr>
									<td>{{forloop.counter}}</td>
									<td>{{obj.title}}</td>
									<td>{{obj.description}}</td>
									<td>
										{% if request.user.is_authenticated %}
											{% if obj.uploaded_by == request.user %}
											<a href="{% url 'documents:delete' pk=obj.pk %}"  data-toggle="tooltip" data-placement="bottom" title="Eliminar categoria." >
												<button  style="border-radius: 50px; padding: 3px;" class="btn btn-danger "><i class="glyphicon glyphicon-remove small"></i> </button>
											</a>
											
											<a data-toggle="modal" data-toggle="tooltip" data-placement="bottom" title="Editar categoria." data-target="#myModal">
												<button  style="border-radius: 50px; padding: 3px;" class="btn btn-warning "><i class="glyphicon glyphicon-pencil small"></i> </button>
											</a>
											{% endif %}
										{% endif %}
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>


			<div class="col-md-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title"><strong>Documentos</strong></h3>
						<div class="pull-right">
							<span class="clickable filter" data-toggle="tooltip" title="Toggle table filter" data-container="body">
								<i class="glyphicon glyphicon-search"></i>
							</span>
						</div>
					</div>
					<div class="panel-body">
						<input type="text" class="form-control" id="generalidades-filter" data-action="filter" data-filters="#generalidades" placeholder="Filter Developers" />
					</div>
					<table class="table table-hover" id="generalidades">
						<thead>
							<tr>
								<th>Seccion</th>
								<th>Nombre documento</th>
								<th>Documento</th>
								<th>Acción</th>
							</tr>
						</thead>
						<tbody>
						{% for obj in object_list %}
							{% for doc in document_list %}
								{% if doc.document_id.id == obj.id %}
									<tr>
										
										<td>
											<strong>
												{{obj.title}}
											</strong>
										</td>
											
										<td>{{doc.name}}</td>
										
										<td>
											<a href="/viewerjs/index.html#{{ cdn }}/media/{{ doc.document_url }}" target="_blank">
												<button class="btn btn-info btn-lg" style="margin: 0 5px 10px 0;"> <span class="glyphicon glyphicon-book"></span> </button>
											</a>
										</td>
	
										<td>
											<a href="#"  data-toggle="tooltip" data-placement="bottom" title="Editar documento." >
												<button  style="border-radius: 50px; padding: 8px;" class="btn btn-warning "><i class="glyphicon glyphicon-pencil small"></i> </button>
											</a>
											&nbsp;
											&nbsp;
											&nbsp;
											<a href="{% url 'documents:delete_upload' pk=doc.pk %}"  data-toggle="tooltip" data-placement="bottom" title="Eliminar documento." >
												<button  style="border-radius: 50px; padding: 8px;" class="btn btn-danger "><i class="glyphicon glyphicon-remove small"></i> </button>
											</a>
	
								
										</td>
									</tr>
								{% endif %}
							{% endfor %}
						{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
	
	
        </div>

	</div>
</section>








<!-- Modal AGREGAR DOCUMENTO -->
<div class="modal fade" id="agregar_documento_id" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			<h4 class="modal-title">Agregar documento</h4>
		</div>
		<div class="modal-body">

			<div class="row">
				<div class="col-md-4 col-md-offset-4">
					<div class="content-section">
						<form method="POST" enctype="multipart/form-data"> 
							{% csrf_token %}
							<fieldset class="form-group">
								<legend class="border-bottom mb-4">Agregar documento</legend>
								{% if errors %}
									<p>{{ errors }}</p><br>
								{% endif %}
								<div>
									<div class="form-group">
										<select name="categoria" id="select_categoria_id" required>
											{% for categoria in object_list %}
												<option value="{{categoria.id}}">{{categoria.title}}</option>
											{% endfor %}
										</select>

									</div>
									<div class="form-group">
										<input placeholder="Nombre" type="text" name="name_document" size="40" required>
									</div>
									<div class="form-group">
										<input type="file" name="document_url" required>
									</div>
								</div>
							</fieldset>
							<div class="form-group">
								<center>
									<button class="btn btn-lg btn-info" type="submit">Subir Documento</button>
								</center>
							</div>
						</form>
					</div>
				</div>
			</div>

		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
		</div>
		</div>
	</div>
	</div>
</div>


<!-- Modal EDITAR CATEGORIA-->
<div class="modal fade" id="myModal" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">&times;</button>
			<h4 class="modal-title">Modal Header</h4>
		</div>
		<div class="modal-body">

			<p>This is a large modal.</p>
			
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		</div>
		</div>
	</div>
	</div>
</div>



		

{% endblock content %}



{% block JS %}
<script type="application/javascript">
	(function(){
		'use strict';
		var $ = jQuery;
		$.fn.extend({
			filterTable: function(){
				return this.each(function(){
					$(this).on('keyup', function(e){
						$('.filterTable_no_results').remove();
						var $this = $(this), 
							search = $this.val().toLowerCase(), 
							target = $this.attr('data-filters'), 
							$target = $(target), 
							$rows = $target.find('tbody tr');
							
						if(search == '') {
							$rows.show(); 
						} else {
							$rows.each(function(){
								var $this = $(this);
								$this.text().toLowerCase().indexOf(search) === -1 ? $this.hide() : $this.show();
							})
							if($target.find('tbody tr:visible').size() === 0) {
								var col_count = $target.find('tr').first().find('td').size();
								var no_results = $('<tr class="filterTable_no_results"><td colspan="'+col_count+'">No results found</td></tr>')
								$target.find('tbody').append(no_results);
							}
						}
					});
				});
			}
		});
		$('[data-action="filter"]').filterTable();
	})(jQuery);

	$(function(){
		// attach table filter plugin to inputs
		$('[data-action="filter"]').filterTable();
		
		$('.container').on('click', '.panel-heading span.filter', function(e){
			var $this = $(this), 
				$panel = $this.parents('.panel');
			
			$panel.find('.panel-body').slideToggle();
			if($this.css('display') != 'none') {
				$panel.find('.panel-body input').focus();
			}
		});
		$('[data-toggle="tooltip"]').tooltip();
	})
</script>
{% endblock JS %}